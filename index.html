<html>
<head>
  <script src="bower_components/jQuery/dist/jquery.min.js"></script>
  <script src="bower_components/d3/d3.min.js"></script>
  <style>
   body {
       font: 10px sans-serif;
   }
   .axis path,
   .axis line {
       fill: none;
       stroke: #000;
       shape-rendering: crispEdges;
   }

   .dot {
       stroke: #000;
       fill: #1F77B4;
   }
  </style>
</head>
<body>
<h4 id="hovered">chevrolet chevelle malibu</h4>
<div class="plot"></div>
<div class="ui">
  <div>
    <label>X-Axis</label>
    <select id="sel-x">
    </select>
    <label>Y-Axis</label>
    <select id="sel-y">
    </select>
  </div>
  <div>
    <input id="mpg-min" type="text" value="0" size="10">
    <input id="mpg-max" type="text" value="30" size="10">
    <button id="update">Query MPG</button>
  </div>
</div>

<script>
 var margin = {top: 20, right: 20, bottom: 30, left: 40};
 var width = 960 - margin.left - margin.right;
 var height = 500 - margin.top - margin.bottom;

 var x = d3.scale.linear().range([0, width]);
 var y = d3.scale.linear().range([height, 0]);

 var xAxis = d3.svg.axis().scale(x).orient("bottom");
 var yAxis = d3.svg.axis().scale(y).orient("left");

 var svg = d3.select(".plot")
             .append("svg")
             .attr("width", width + margin.left + margin.right)
             .attr("height", height + margin.top + margin.bottom)
             .append("g")
             .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

 var xCol = function() { return +$("#sel-x").val(); }
 var yCol = function() { return +$("#sel-y").val(); }

 d3.text("car.csv", function(text) {
   var rows = d3.csv.parseRows(text);
   var headers = rows.shift().slice(1, -1);

   // Parse data
   rows = rows.map(function(row) {
     return row.map(function(val) { return +val; });
   });

   // Fill dropdowns
   $("select").each(function(_, dropdown) {
     $.each(headers, function(i, name) {
       $(dropdown).append($("<option></option>").attr("value",i).text(name));
     });
   });

   var getPoints = function(x, y) {
     return rows.map(function(row) {
       return {x: row[x+1], y: row[y+1], name: row[0]};
     });
   };

   var xLabel = svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
      .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end");

   var yLabel = svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
      .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end");

   var renderPlot = function() {
     var xTitle = headers[xCol()];
     var yTitle = headers[yCol()];
     var data = getPoints(xCol(), yCol());

     x.domain(d3.extent(data, function(d) { return d.x; })).nice();
     y.domain(d3.extent(data, function(d) { return d.y; })).nice();

     svg.selectAll("g .x.axis").call(xAxis);
     svg.selectAll("g .y.axis").call(yAxis);
     xLabel.text(xTitle);
     yLabel.text(yTitle);

     var dots = svg.selectAll(".dot").data(data);

     var t = d3.transition().duration(750);

     dots.transition(t)
         .attr("cx", function(d) { return x(d.x); })
         .attr("cy", function(d) { return y(d.y); });

     dots.enter()
         .append("circle")
         .attr("class", "dot")
         .attr("r", 3.5)
         .attr("cx", function(d) { return x(d.x); })
         .attr("cy", function(d) { return y(d.y); });

     dots.exit().remove();
   };

   renderPlot();

   $('select').each(function(_, dropdown) {
     $(dropdown).change(renderPlot);
   });
 });
</script>
</body>
</html>
